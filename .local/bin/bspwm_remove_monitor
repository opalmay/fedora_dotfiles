#!/bin/sh

bspc subscribe monitor_remove | while read line
do
  echo $(bspc query -M)
  line=$(echo $line | awk '{print $2}')
  echo "Moving from: $line"
  to_monitor=$(bspc query -M  | head -1)
  to_desktops=$(bspc query -D -m $to_monitor)
  i=1
  for desktop in $(bspc query -D -m $line)
  do
    echo "$desktop"
    to_desktop=$(echo "$to_desktops" | awk 'NR==$i')
    for node in $(bspc query -N -d $desktop)
    do
node      bspc node -d $node:$to_desktop
    done
    
    let i++
  done
done
